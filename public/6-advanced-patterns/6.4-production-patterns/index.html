<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.92.2" />
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/images/favicon.png" type="image/png">

    <title>6.4 Production Patterns :: DynamoDB Advanced Patterns Workshop</title>

    
    <link href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/css/nucleus.css?1755087796" rel="stylesheet">
    <link href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/css/fontawesome-all.min.css?1755087796" rel="stylesheet">
    <link href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/css/hybrid.css?1755087796" rel="stylesheet">
    <link href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/css/featherlight.min.css?1755087796" rel="stylesheet">
    <link href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/css/perfect-scrollbar.min.css?1755087796" rel="stylesheet">
    <link href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/css/auto-complete.css?1755087796" rel="stylesheet">
    <link href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/css/atom-one-dark-reasonable.css?1755087796" rel="stylesheet">
    <link href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/css/theme.css?1755087796" rel="stylesheet">
    <link href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/css/hugo-theme.css?1755087796" rel="stylesheet">
    
    <link href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/css/theme-workshop.css?1755087796" rel="stylesheet">
    
    

    <script src="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/js/jquery-3.3.1.min.js?1755087796"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/6-advanced-patterns/6.4-production-patterns/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/js/lunr.min.js?1755087796"></script>
<script type="text/javascript" src="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/js/auto-complete.js?1755087796"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/crimsondd.github.io\/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams\/";
    
</script>
<script type="text/javascript" src="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/js/search.js?1755087796"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/1-setup-infrastructure/" title="1. Setup &amp; Infrastructure Deployment" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/1-setup-infrastructure/">
           <b> 1. </b> 1. Setup &amp; Infrastructure Deployment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/1-setup-infrastructure/1.1-aws-freetier-overview/" title="1.1 AWS Free Tier Overview" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/1-setup-infrastructure/1.1-aws-freetier-overview/">
           <b> 1.1 </b> 1.1 AWS Free Tier Overview
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/1-setup-infrastructure/1.2-architecture-overview/" title="1.2 Architecture Overview" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/1-setup-infrastructure/1.2-architecture-overview/">
           <b> 1.2 </b> 1.2 Architecture Overview
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/1-setup-infrastructure/1.3-cloudformation-deployment/" title="1.3 CloudFormation Deployment" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/1-setup-infrastructure/1.3-cloudformation-deployment/">
           <b> 1.3 </b> 1.3 CloudFormation Deployment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/1-setup-infrastructure/1.4-infrastructure-verification/" title="1.4 Infrastructure Verification" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/1-setup-infrastructure/1.4-infrastructure-verification/">
           <b> 1.4 </b> 1.4 Infrastructure Verification
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/2-single-table-design/" title="2. Single Table Design Implementation" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/2-single-table-design/">
           <b> 2. </b> 2. Single Table Design Implementation
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/2-single-table-design/2.1-design-principles/" title="2.1 Design Principles" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/2-single-table-design/2.1-design-principles/">
           <b> 2.1 </b> 2.1 Design Principles
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/2-single-table-design/2.2-console-navigation/" title="2.2 Console Navigation" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/2-single-table-design/2.2-console-navigation/">
           <b> 2.2 </b> 2.2 Console Navigation
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/2-single-table-design/2.3-create-data-items/" title="2.3 Create Data Items" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/2-single-table-design/2.3-create-data-items/">
           <b> 2.3 </b> 2.3 Create Data Items
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/2-single-table-design/2.4-query-patterns/" title="2.4 Query Patterns" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/2-single-table-design/2.4-query-patterns/">
           <b> 2.4 </b> 2.4 Query Patterns
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/3-global-tables-setup/" title="3. Global Tables Multi-Region Setup" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/3-global-tables-setup/">
           <b> 3. </b> 3. Global Tables Multi-Region Setup
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/3-global-tables-setup/3.1-global-tables-overview/" title="3.1 Global Tables Overview" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/3-global-tables-setup/3.1-global-tables-overview/">
           <b> 3.1 </b> 3.1 Global Tables Overview
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/3-global-tables-setup/3.2-verify-global-setup/" title="3.2 Verify Global Setup" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/3-global-tables-setup/3.2-verify-global-setup/">
           <b> 3.2 </b> 3.2 Verify Global Setup
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/3-global-tables-setup/3.3-multi-region-operations/" title="3.3 Multi-Region Operations" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/3-global-tables-setup/3.3-multi-region-operations/">
           <b> 3.3 </b> 3.3 Multi-Region Operations
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/3-global-tables-setup/3.4-replication-monitoring/" title="3.4 Replication Monitoring" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/3-global-tables-setup/3.4-replication-monitoring/">
           <b> 3.4 </b> 3.4 Replication Monitoring
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/4-streams-lambda-processing/" title="4. Streams &amp; Lambda Processing" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/4-streams-lambda-processing/">
           <b> 4. </b> 4. Streams &amp; Lambda Processing
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/4-streams-lambda-processing/4.1-stream-configuration/" title="4.1 Stream Configuration" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/4-streams-lambda-processing/4.1-stream-configuration/">
           <b> 4.1 </b> 4.1 Stream Configuration
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/4-streams-lambda-processing/4.2-lambda-function-setup/" title="4.2 Lambda Function Setup" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/4-streams-lambda-processing/4.2-lambda-function-setup/">
           <b> 4.2 </b> 4.2 Lambda Function Setup
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/4-streams-lambda-processing/4.3-event-processing-practice/" title="4.3 Event Processing Practice" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/4-streams-lambda-processing/4.3-event-processing-practice/">
           <b> 4.3 </b> 4.3 Event Processing Practice
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/4-streams-lambda-processing/4.4-monitoring-debugging/" title="4.4 Monitoring &amp; Debugging" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/4-streams-lambda-processing/4.4-monitoring-debugging/">
           <b> 4.4 </b> 4.4 Monitoring &amp; Debugging
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/5-monitoring-optimization/" title="5. Monitoring &amp; Optimization" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/5-monitoring-optimization/">
           <b> 5. </b> 5. Monitoring &amp; Optimization
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/5-monitoring-optimization/5.1-cloudwatch-dashboards/" title="5.1 CloudWatch Dashboards" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/5-monitoring-optimization/5.1-cloudwatch-dashboards/">
           <b> 5.1 </b> 5.1 CloudWatch Dashboards
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/5-monitoring-optimization/5.2-alerting-notifications/" title="5.2 Alerting &amp; Notifications" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/5-monitoring-optimization/5.2-alerting-notifications/">
           <b> 5.2 </b> 5.2 Alerting &amp; Notifications
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/5-monitoring-optimization/5.3-cost-analysis-optimization/" title="5.3 Cost Analysis &amp; Optimization" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/5-monitoring-optimization/5.3-cost-analysis-optimization/">
           <b> 5.3 </b> 5.3 Cost Analysis &amp; Optimization
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/5-monitoring-optimization/5.4-performance-tuning/" title="5.4 Performance Tuning" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/5-monitoring-optimization/5.4-performance-tuning/">
           <b> 5.4 </b> 5.4 Performance Tuning
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/6-advanced-patterns/" title="6. Advanced Patterns" class="dd-item 
        parent
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/6-advanced-patterns/">
           <b> 6. </b> 6. Advanced Patterns
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/6-advanced-patterns/6.1-batch-operations/" title="6.1 Batch Operations" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/6-advanced-patterns/6.1-batch-operations/">
           <b> 6.1 </b> 6.1 Batch Operations
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/6-advanced-patterns/6.2-conditional-updates/" title="6.2 Conditional Updates" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/6-advanced-patterns/6.2-conditional-updates/">
           <b> 6.2 </b> 6.2 Conditional Updates
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/6-advanced-patterns/6.3-advanced-query-techniques/" title="6.3 Advanced Query Techniques" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/6-advanced-patterns/6.3-advanced-query-techniques/">
           <b> 6.3 </b> 6.3 Advanced Query Techniques
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/6-advanced-patterns/6.4-production-patterns/" title="6.4 Production Patterns" class="dd-item 
        parent
        active
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/6-advanced-patterns/6.4-production-patterns/">
           <b> 6.4 </b> 6.4 Production Patterns
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/7-cleanup-resources/" title="7. Cleanup Resources" class="dd-item 
        
        
        
        ">
      <a href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/7-cleanup-resources/">
           <b> 7. </b> 7. Cleanup Resources
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://aws.amazon.com/blogs"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj"><i class='fab fa-facebook'></i> AWS Study Group - FB Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="https://crimsondd.github.io/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/6-advanced-patterns/6.4-production-patterns/" selected>English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="https://crimsondd.github.io/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/vi/6-advanced-patterns/6.4-production-patterns/">Ti·∫øng Vi·ªát</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830891&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>26-11-2023</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i>
                <a href="https://www.linkedin.com/in/jotaguy"  style="color:orange">Gia H∆∞ng</a>
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/'>DynamoDB Advanced Patterns Workshop</a> > <a href='/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/6-advanced-patterns/'>6. Advanced Patterns</a> > 6.4 Production Patterns
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#enterprise-grade-implementation-patterns">Enterprise-Grade Implementation Patterns</a>
      <ul>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#enterprise-requirements">Enterprise Requirements</a></li>
        <li><a href="#pattern-categories">Pattern Categories</a></li>
      </ul>
    </li>
    <li><a href="#exercise-1-data-access-layer-pattern">Exercise 1: Data Access Layer Pattern</a>
      <ul>
        <li><a href="#step-1-repository-pattern-implementation">Step 1: Repository Pattern Implementation</a></li>
        <li><a href="#step-2-repository-usage-examples">Step 2: Repository Usage Examples</a></li>
      </ul>
    </li>
    <li><a href="#exercise-2-caching-strategy-pattern">Exercise 2: Caching Strategy Pattern</a>
      <ul>
        <li><a href="#step-1-application-level-caching">Step 1: Application-Level Caching</a></li>
        <li><a href="#step-2-cache-performance-testing">Step 2: Cache Performance Testing</a></li>
      </ul>
    </li>
    <li><a href="#exercise-3-error-handling-and-resilience">Exercise 3: Error Handling and Resilience</a>
      <ul>
        <li><a href="#step-1-comprehensive-error-handling">Step 1: Comprehensive Error Handling</a></li>
        <li><a href="#step-2-circuit-breaker-pattern">Step 2: Circuit Breaker Pattern</a></li>
      </ul>
    </li>
    <li><a href="#exercise-4-connection-pool-and-resource-management">Exercise 4: Connection Pool and Resource Management</a>
      <ul>
        <li><a href="#step-1-connection-pool-implementation">Step 1: Connection Pool Implementation</a></li>
        <li><a href="#step-2-resource-optimization-testing">Step 2: Resource Optimization Testing</a></li>
      </ul>
    </li>
    <li><a href="#exercise-5-production-monitoring-and-observability">Exercise 5: Production Monitoring and Observability</a>
      <ul>
        <li><a href="#step-1-comprehensive-metrics-collection">Step 1: Comprehensive Metrics Collection</a></li>
        <li><a href="#step-2-performance-monitoring-demo">Step 2: Performance Monitoring Demo</a></li>
      </ul>
    </li>
    <li><a href="#production-patterns-best-practices">Production Patterns Best Practices</a>
      <ul>
        <li><a href="#architecture-guidelines">Architecture Guidelines</a></li>
        <li><a href="#performance-optimization">Performance Optimization</a></li>
        <li><a href="#operational-excellence">Operational Excellence</a></li>
      </ul>
    </li>
    <li><a href="#exercise-summary">Exercise Summary</a></li>
    <li><a href="#module-6-complete">Module 6 Complete</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              6.4 Production Patterns
            </h1>
          

        



	<h2 id="enterprise-grade-implementation-patterns">Enterprise-Grade Implementation Patterns</h2>
<p>üè¢ <strong>Master production-ready patterns and best practices for enterprise DynamoDB applications</strong></p>
<h3 id="overview">Overview</h3>
<p>Production patterns represent the culmination of DynamoDB expertise‚Äîproven techniques used by companies serving millions of users. Learn how to implement robust, scalable, and maintainable DynamoDB solutions that perform reliably under real-world conditions.</p>
<h3 id="enterprise-requirements">Enterprise Requirements</h3>
<p><strong>Production-grade characteristics</strong>:</p>
<ul>
<li><strong>Reliability</strong>: 99.9%+ uptime with graceful error handling</li>
<li><strong>Performance</strong>: Consistent sub-50ms response times</li>
<li><strong>Scalability</strong>: Handle traffic spikes without degradation</li>
<li><strong>Maintainability</strong>: Clean, documented, and testable code</li>
<li><strong>Cost Efficiency</strong>: Optimize for operational costs</li>
</ul>
<h3 id="pattern-categories">Pattern Categories</h3>
<pre tabindex="0"><code>Production Pattern Types:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Pattern Type        ‚îÇ Use Case            ‚îÇ Benefit         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Data Access Layer   ‚îÇ Clean separation    ‚îÇ Maintainable   ‚îÇ
‚îÇ Caching Strategy    ‚îÇ Performance boost   ‚îÇ Lower latency   ‚îÇ
‚îÇ Error Handling      ‚îÇ Robust operations   ‚îÇ Better UX       ‚îÇ
‚îÇ Connection Pool     ‚îÇ Resource efficiency ‚îÇ Cost savings    ‚îÇ
‚îÇ Monitoring          ‚îÇ Operational insight ‚îÇ Proactive fixes ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre><h2 id="exercise-1-data-access-layer-pattern">Exercise 1: Data Access Layer Pattern</h2>
<h3 id="step-1-repository-pattern-implementation">Step 1: Repository Pattern Implementation</h3>
<p><strong>Create a clean data access abstraction</strong>:</p>
<ol>
<li><strong>AWS CloudShell</strong>: Open CloudShell from AWS Console</li>
<li><strong>Create repository class structure</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> boto3
<span style="color:#f92672">import</span> json
<span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Dict, List, Optional, Any
<span style="color:#f92672">from</span> botocore.exceptions <span style="color:#f92672">import</span> ClientError
<span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime
<span style="color:#f92672">import</span> uuid

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DynamoDBRepository</span>:
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Enterprise-grade DynamoDB repository with error handling and logging
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    <span style="color:#66d9ef">def</span> __init__(self, table_name: str, region: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;us-east-1&#39;</span>):
        self<span style="color:#f92672">.</span>table_name <span style="color:#f92672">=</span> table_name
        self<span style="color:#f92672">.</span>dynamodb <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>resource(<span style="color:#e6db74">&#39;dynamodb&#39;</span>, region_name<span style="color:#f92672">=</span>region)
        self<span style="color:#f92672">.</span>table <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>dynamodb<span style="color:#f92672">.</span>Table(table_name)
        self<span style="color:#f92672">.</span>client <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;dynamodb&#39;</span>, region_name<span style="color:#f92672">=</span>region)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_item</span>(self, item: Dict[str, Any], condition: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Create item with optional condition check
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">try</span>:
            <span style="color:#75715e"># Add metadata</span>
            item[<span style="color:#e6db74">&#39;created_at&#39;</span>] <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>utcnow()<span style="color:#f92672">.</span>isoformat()
            item[<span style="color:#e6db74">&#39;updated_at&#39;</span>] <span style="color:#f92672">=</span> item[<span style="color:#e6db74">&#39;created_at&#39;</span>]
            
            put_params <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;Item&#39;</span>: item}
            <span style="color:#66d9ef">if</span> condition:
                put_params[<span style="color:#e6db74">&#39;ConditionExpression&#39;</span>] <span style="color:#f92672">=</span> condition
            
            self<span style="color:#f92672">.</span>table<span style="color:#f92672">.</span>put_item(<span style="color:#f92672">**</span>put_params)
            
            <span style="color:#66d9ef">return</span> {
                <span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">True</span>,
                <span style="color:#e6db74">&#39;item&#39;</span>: item,
                <span style="color:#e6db74">&#39;operation&#39;</span>: <span style="color:#e6db74">&#39;create&#39;</span>
            }
            
        <span style="color:#66d9ef">except</span> ClientError <span style="color:#66d9ef">as</span> e:
            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_handle_error(e, <span style="color:#e6db74">&#39;create_item&#39;</span>, item)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_item</span>(self, key: Dict[str, str], projection: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Get single item with optional projection
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">try</span>:
            get_params <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;Key&#39;</span>: key}
            <span style="color:#66d9ef">if</span> projection:
                get_params[<span style="color:#e6db74">&#39;ProjectionExpression&#39;</span>] <span style="color:#f92672">=</span> projection
            
            response <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>table<span style="color:#f92672">.</span>get_item(<span style="color:#f92672">**</span>get_params)
            
            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;Item&#39;</span> <span style="color:#f92672">in</span> response:
                <span style="color:#66d9ef">return</span> {
                    <span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">True</span>,
                    <span style="color:#e6db74">&#39;item&#39;</span>: response[<span style="color:#e6db74">&#39;Item&#39;</span>],
                    <span style="color:#e6db74">&#39;found&#39;</span>: <span style="color:#66d9ef">True</span>
                }
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">return</span> {
                    <span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">True</span>,
                    <span style="color:#e6db74">&#39;item&#39;</span>: <span style="color:#66d9ef">None</span>,
                    <span style="color:#e6db74">&#39;found&#39;</span>: <span style="color:#66d9ef">False</span>
                }
                
        <span style="color:#66d9ef">except</span> ClientError <span style="color:#66d9ef">as</span> e:
            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_handle_error(e, <span style="color:#e6db74">&#39;get_item&#39;</span>, key)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update_item</span>(self, key: Dict[str, str], updates: Dict[str, Any], 
                   condition: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Update item with automatic versioning and timestamp
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">try</span>:
            <span style="color:#75715e"># Build update expression</span>
            update_expr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SET updated_at = :updated_at&#34;</span>
            expr_values <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;:updated_at&#39;</span>: datetime<span style="color:#f92672">.</span>utcnow()<span style="color:#f92672">.</span>isoformat()}
            
            <span style="color:#66d9ef">for</span> attr, value <span style="color:#f92672">in</span> updates<span style="color:#f92672">.</span>items():
                update_expr <span style="color:#f92672">+=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;, </span><span style="color:#e6db74">{</span>attr<span style="color:#e6db74">}</span><span style="color:#e6db74"> = :</span><span style="color:#e6db74">{</span>attr<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
                expr_values[<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;:</span><span style="color:#e6db74">{</span>attr<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">=</span> value
            
            <span style="color:#75715e"># Add version increment if version exists</span>
            update_expr <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;, version = if_not_exists(version, :zero) + :inc&#34;</span>
            expr_values[<span style="color:#e6db74">&#39;:zero&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
            expr_values[<span style="color:#e6db74">&#39;:inc&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
            
            update_params <span style="color:#f92672">=</span> {
                <span style="color:#e6db74">&#39;Key&#39;</span>: key,
                <span style="color:#e6db74">&#39;UpdateExpression&#39;</span>: update_expr,
                <span style="color:#e6db74">&#39;ExpressionAttributeValues&#39;</span>: expr_values,
                <span style="color:#e6db74">&#39;ReturnValues&#39;</span>: <span style="color:#e6db74">&#39;ALL_NEW&#39;</span>
            }
            
            <span style="color:#66d9ef">if</span> condition:
                update_params[<span style="color:#e6db74">&#39;ConditionExpression&#39;</span>] <span style="color:#f92672">=</span> condition
            
            response <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>table<span style="color:#f92672">.</span>update_item(<span style="color:#f92672">**</span>update_params)
            
            <span style="color:#66d9ef">return</span> {
                <span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">True</span>,
                <span style="color:#e6db74">&#39;item&#39;</span>: response[<span style="color:#e6db74">&#39;Attributes&#39;</span>],
                <span style="color:#e6db74">&#39;operation&#39;</span>: <span style="color:#e6db74">&#39;update&#39;</span>
            }
            
        <span style="color:#66d9ef">except</span> ClientError <span style="color:#66d9ef">as</span> e:
            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_handle_error(e, <span style="color:#e6db74">&#39;update_item&#39;</span>, {<span style="color:#e6db74">&#39;key&#39;</span>: key, <span style="color:#e6db74">&#39;updates&#39;</span>: updates})
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">query_items</span>(self, key_condition: str, index_name: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>,
                   filter_expr: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>, projection: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>,
                   limit: Optional[int] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Query items with comprehensive parameters
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">try</span>:
            query_params <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;KeyConditionExpression&#39;</span>: key_condition}
            
            <span style="color:#66d9ef">if</span> index_name:
                query_params[<span style="color:#e6db74">&#39;IndexName&#39;</span>] <span style="color:#f92672">=</span> index_name
            <span style="color:#66d9ef">if</span> filter_expr:
                query_params[<span style="color:#e6db74">&#39;FilterExpression&#39;</span>] <span style="color:#f92672">=</span> filter_expr
            <span style="color:#66d9ef">if</span> projection:
                query_params[<span style="color:#e6db74">&#39;ProjectionExpression&#39;</span>] <span style="color:#f92672">=</span> projection
            <span style="color:#66d9ef">if</span> limit:
                query_params[<span style="color:#e6db74">&#39;Limit&#39;</span>] <span style="color:#f92672">=</span> limit
            
            response <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>table<span style="color:#f92672">.</span>query(<span style="color:#f92672">**</span>query_params)
            
            <span style="color:#66d9ef">return</span> {
                <span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">True</span>,
                <span style="color:#e6db74">&#39;items&#39;</span>: response[<span style="color:#e6db74">&#39;Items&#39;</span>],
                <span style="color:#e6db74">&#39;count&#39;</span>: response[<span style="color:#e6db74">&#39;Count&#39;</span>],
                <span style="color:#e6db74">&#39;last_key&#39;</span>: response<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;LastEvaluatedKey&#39;</span>)
            }
            
        <span style="color:#66d9ef">except</span> ClientError <span style="color:#66d9ef">as</span> e:
            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_handle_error(e, <span style="color:#e6db74">&#39;query_items&#39;</span>, query_params)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_handle_error</span>(self, error: ClientError, operation: str, context: Any) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Centralized error handling with logging
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        error_code <span style="color:#f92672">=</span> error<span style="color:#f92672">.</span>response[<span style="color:#e6db74">&#39;Error&#39;</span>][<span style="color:#e6db74">&#39;Code&#39;</span>]
        error_message <span style="color:#f92672">=</span> error<span style="color:#f92672">.</span>response[<span style="color:#e6db74">&#39;Error&#39;</span>][<span style="color:#e6db74">&#39;Message&#39;</span>]
        
        <span style="color:#75715e"># Log error (in production, use proper logging)</span>
        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;DynamoDB Error in </span><span style="color:#e6db74">{</span>operation<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>error_code<span style="color:#e6db74">}</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">{</span>error_message<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Context: </span><span style="color:#e6db74">{</span>json<span style="color:#f92672">.</span>dumps(context, default<span style="color:#f92672">=</span>str)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
        
        <span style="color:#66d9ef">return</span> {
            <span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">False</span>,
            <span style="color:#e6db74">&#39;error_code&#39;</span>: error_code,
            <span style="color:#e6db74">&#39;error_message&#39;</span>: error_message,
            <span style="color:#e6db74">&#39;operation&#39;</span>: operation
        }

<span style="color:#75715e"># Usage example</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ProductRepository</span>(DynamoDBRepository):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Product-specific repository with business logic
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_product</span>(self, product_data: Dict[str, Any]) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Create product with business validation
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#75715e"># Generate unique product ID</span>
        product_id <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;PRODUCT#</span><span style="color:#e6db74">{</span>uuid<span style="color:#f92672">.</span>uuid4()<span style="color:#f92672">.</span>hex[:<span style="color:#ae81ff">8</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
        
        item <span style="color:#f92672">=</span> {
            <span style="color:#e6db74">&#39;PK&#39;</span>: product_id,
            <span style="color:#e6db74">&#39;SK&#39;</span>: <span style="color:#e6db74">&#39;DETAILS&#39;</span>,
            <span style="color:#e6db74">&#39;GSI1PK&#39;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;CATEGORY#</span><span style="color:#e6db74">{</span>product_data[<span style="color:#e6db74">&#39;category&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
            <span style="color:#e6db74">&#39;GSI1SK&#39;</span>: product_id,
            <span style="color:#f92672">**</span>product_data
        }
        
        <span style="color:#75715e"># Ensure product doesn&#39;t already exist</span>
        condition <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;attribute_not_exists(PK)&#34;</span>
        
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>create_item(item, condition)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_product</span>(self, product_id: str) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Get product by ID with error handling
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        key <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;PK&#39;</span>: product_id, <span style="color:#e6db74">&#39;SK&#39;</span>: <span style="color:#e6db74">&#39;DETAILS&#39;</span>}
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>get_item(key)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update_product_stock</span>(self, product_id: str, quantity_change: int) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Update product stock with safety checks
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        key <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;PK&#39;</span>: product_id, <span style="color:#e6db74">&#39;SK&#39;</span>: <span style="color:#e6db74">&#39;DETAILS&#39;</span>}
        
        <span style="color:#66d9ef">if</span> quantity_change <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
            <span style="color:#75715e"># Decreasing stock - ensure sufficient quantity</span>
            updates <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;stock&#39;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;stock - </span><span style="color:#e6db74">{</span>abs(quantity_change)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>}
            condition <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;stock &gt;= </span><span style="color:#e6db74">{</span>abs(quantity_change)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
        <span style="color:#66d9ef">else</span>:
            <span style="color:#75715e"># Increasing stock</span>
            updates <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;stock&#39;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;stock + </span><span style="color:#e6db74">{</span>quantity_change<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>}
            condition <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
        
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>update_item(key, updates, condition)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_products_by_category</span>(self, category: str, limit: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Get products by category using GSI
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        key_condition <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;GSI1PK = :category&#34;</span>
        
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>query_items(
            key_condition<span style="color:#f92672">=</span>key_condition,
            index_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;GSI1&#39;</span>,
            projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;PK, SK, name, price, stock&#39;</span>,
            limit<span style="color:#f92672">=</span>limit
        )
</code></pre></div>
<div class="notices info" ><p><strong>Screenshot Location</strong>: Add screenshot showing repository pattern code implementation in CloudShell</p>
</div>

<h3 id="step-2-repository-usage-examples">Step 2: Repository Usage Examples</h3>
<p><strong>Implement business operations using the repository</strong>:</p>
<ol>
<li><strong>Create test products using repository</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Initialize repository</span>
product_repo <span style="color:#f92672">=</span> ProductRepository(<span style="color:#e6db74">&#39;demo-ecommerce-freetier&#39;</span>)

<span style="color:#75715e"># Create products</span>
laptop_result <span style="color:#f92672">=</span> product_repo<span style="color:#f92672">.</span>create_product({
    <span style="color:#e6db74">&#39;name&#39;</span>: <span style="color:#e6db74">&#39;Enterprise Laptop&#39;</span>,
    <span style="color:#e6db74">&#39;price&#39;</span>: <span style="color:#ae81ff">1499</span>,
    <span style="color:#e6db74">&#39;stock&#39;</span>: <span style="color:#ae81ff">10</span>,
    <span style="color:#e6db74">&#39;category&#39;</span>: <span style="color:#e6db74">&#39;electronics&#39;</span>,
    <span style="color:#e6db74">&#39;brand&#39;</span>: <span style="color:#e6db74">&#39;TechCorp&#39;</span>
})

mouse_result <span style="color:#f92672">=</span> product_repo<span style="color:#f92672">.</span>create_product({
    <span style="color:#e6db74">&#39;name&#39;</span>: <span style="color:#e6db74">&#39;Wireless Mouse Pro&#39;</span>,
    <span style="color:#e6db74">&#39;price&#39;</span>: <span style="color:#ae81ff">89</span>,
    <span style="color:#e6db74">&#39;stock&#39;</span>: <span style="color:#ae81ff">50</span>,
    <span style="color:#e6db74">&#39;category&#39;</span>: <span style="color:#e6db74">&#39;electronics&#39;</span>,
    <span style="color:#e6db74">&#39;brand&#39;</span>: <span style="color:#e6db74">&#39;AccessoryCorp&#39;</span>
})

print(<span style="color:#e6db74">&#34;Laptop creation:&#34;</span>, laptop_result[<span style="color:#e6db74">&#39;success&#39;</span>])
print(<span style="color:#e6db74">&#34;Mouse creation:&#34;</span>, mouse_result[<span style="color:#e6db74">&#39;success&#39;</span>])
</code></pre></div><ol start="2">
<li><strong>Business operations with error handling</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Safe stock update</span>
<span style="color:#66d9ef">if</span> laptop_result[<span style="color:#e6db74">&#39;success&#39;</span>]:
    product_id <span style="color:#f92672">=</span> laptop_result[<span style="color:#e6db74">&#39;item&#39;</span>][<span style="color:#e6db74">&#39;PK&#39;</span>]
    
    <span style="color:#75715e"># Successful stock decrease</span>
    stock_result <span style="color:#f92672">=</span> product_repo<span style="color:#f92672">.</span>update_product_stock(product_id, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>)
    print(<span style="color:#e6db74">&#34;Stock update:&#34;</span>, stock_result[<span style="color:#e6db74">&#39;success&#39;</span>])
    
    <span style="color:#75715e"># Attempt overselling (should fail)</span>
    oversell_result <span style="color:#f92672">=</span> product_repo<span style="color:#f92672">.</span>update_product_stock(product_id, <span style="color:#f92672">-</span><span style="color:#ae81ff">100</span>)
    print(<span style="color:#e6db74">&#34;Oversell prevented:&#34;</span>, <span style="color:#f92672">not</span> oversell_result[<span style="color:#e6db74">&#39;success&#39;</span>])
</code></pre></div>
<div class="notices info" ><p><strong>Screenshot Location</strong>: Add screenshot showing repository business operations execution</p>
</div>

<h2 id="exercise-2-caching-strategy-pattern">Exercise 2: Caching Strategy Pattern</h2>
<h3 id="step-1-application-level-caching">Step 1: Application-Level Caching</h3>
<p><strong>Implement intelligent caching for performance</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> time
<span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Dict, Any, Optional
<span style="color:#f92672">from</span> threading <span style="color:#f92672">import</span> Lock

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DynamoDBCacheManager</span>:
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Production-ready caching layer for DynamoDB
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    <span style="color:#66d9ef">def</span> __init__(self, repository: DynamoDBRepository, ttl_seconds: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">300</span>):
        self<span style="color:#f92672">.</span>repository <span style="color:#f92672">=</span> repository
        self<span style="color:#f92672">.</span>ttl <span style="color:#f92672">=</span> ttl_seconds
        self<span style="color:#f92672">.</span>cache <span style="color:#f92672">=</span> {}
        self<span style="color:#f92672">.</span>cache_stats <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;hits&#39;</span>: <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;misses&#39;</span>: <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;evictions&#39;</span>: <span style="color:#ae81ff">0</span>}
        self<span style="color:#f92672">.</span>lock <span style="color:#f92672">=</span> Lock()
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_item_cached</span>(self, key: Dict[str, str], projection: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Get item with caching layer
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        cache_key <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_generate_cache_key(key, projection)
        
        <span style="color:#66d9ef">with</span> self<span style="color:#f92672">.</span>lock:
            <span style="color:#75715e"># Check cache first</span>
            <span style="color:#66d9ef">if</span> cache_key <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>cache:
                cached_item, timestamp <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>cache[cache_key]
                
                <span style="color:#66d9ef">if</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> timestamp <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>ttl:
                    self<span style="color:#f92672">.</span>cache_stats[<span style="color:#e6db74">&#39;hits&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                    <span style="color:#66d9ef">return</span> {
                        <span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">True</span>,
                        <span style="color:#e6db74">&#39;item&#39;</span>: cached_item,
                        <span style="color:#e6db74">&#39;from_cache&#39;</span>: <span style="color:#66d9ef">True</span>
                    }
                <span style="color:#66d9ef">else</span>:
                    <span style="color:#75715e"># Cache expired</span>
                    <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>cache[cache_key]
                    self<span style="color:#f92672">.</span>cache_stats[<span style="color:#e6db74">&#39;evictions&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
        
        <span style="color:#75715e"># Cache miss - fetch from DynamoDB</span>
        self<span style="color:#f92672">.</span>cache_stats[<span style="color:#e6db74">&#39;misses&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
        result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>repository<span style="color:#f92672">.</span>get_item(key, projection)
        
        <span style="color:#66d9ef">if</span> result[<span style="color:#e6db74">&#39;success&#39;</span>] <span style="color:#f92672">and</span> result<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;found&#39;</span>):
            <span style="color:#66d9ef">with</span> self<span style="color:#f92672">.</span>lock:
                self<span style="color:#f92672">.</span>cache[cache_key] <span style="color:#f92672">=</span> (result[<span style="color:#e6db74">&#39;item&#39;</span>], time<span style="color:#f92672">.</span>time())
        
        result[<span style="color:#e6db74">&#39;from_cache&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
        <span style="color:#66d9ef">return</span> result
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">invalidate_cache</span>(self, key: Dict[str, str], projection: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Remove item from cache when updated
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        cache_key <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_generate_cache_key(key, projection)
        <span style="color:#66d9ef">with</span> self<span style="color:#f92672">.</span>lock:
            self<span style="color:#f92672">.</span>cache<span style="color:#f92672">.</span>pop(cache_key, <span style="color:#66d9ef">None</span>)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update_item_with_cache</span>(self, key: Dict[str, str], updates: Dict[str, Any],
                              condition: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Update item and invalidate cache
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>repository<span style="color:#f92672">.</span>update_item(key, updates, condition)
        
        <span style="color:#66d9ef">if</span> result[<span style="color:#e6db74">&#39;success&#39;</span>]:
            self<span style="color:#f92672">.</span>invalidate_cache(key)
        
        <span style="color:#66d9ef">return</span> result
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_cache_stats</span>(self) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Get cache performance statistics
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        total_requests <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>cache_stats[<span style="color:#e6db74">&#39;hits&#39;</span>] <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>cache_stats[<span style="color:#e6db74">&#39;misses&#39;</span>]
        hit_rate <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>cache_stats[<span style="color:#e6db74">&#39;hits&#39;</span>] <span style="color:#f92672">/</span> max(total_requests, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>
        
        <span style="color:#66d9ef">return</span> {
            <span style="color:#f92672">**</span>self<span style="color:#f92672">.</span>cache_stats,
            <span style="color:#e6db74">&#39;hit_rate_percent&#39;</span>: round(hit_rate, <span style="color:#ae81ff">2</span>),
            <span style="color:#e6db74">&#39;cache_size&#39;</span>: len(self<span style="color:#f92672">.</span>cache)
        }
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_generate_cache_key</span>(self, key: Dict[str, str], projection: Optional[str]) <span style="color:#f92672">-&gt;</span> str:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Generate consistent cache key
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        key_str <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>dumps(key, sort_keys<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
        projection_str <span style="color:#f92672">=</span> projection <span style="color:#f92672">or</span> <span style="color:#e6db74">&#39;full&#39;</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>key_str<span style="color:#e6db74">}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">{</span>projection_str<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>

<span style="color:#75715e"># Enhanced product repository with caching</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CachedProductRepository</span>(ProductRepository):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Product repository with integrated caching
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    <span style="color:#66d9ef">def</span> __init__(self, table_name: str, cache_ttl: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">300</span>):
        super()<span style="color:#f92672">.</span>__init__(table_name)
        self<span style="color:#f92672">.</span>cache_manager <span style="color:#f92672">=</span> DynamoDBCacheManager(self, cache_ttl)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_product_cached</span>(self, product_id: str) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Get product with caching
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        key <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;PK&#39;</span>: product_id, <span style="color:#e6db74">&#39;SK&#39;</span>: <span style="color:#e6db74">&#39;DETAILS&#39;</span>}
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>cache_manager<span style="color:#f92672">.</span>get_item_cached(key)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update_product_with_cache_invalidation</span>(self, product_id: str, updates: Dict[str, Any]) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Update product and invalidate cache
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        key <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;PK&#39;</span>: product_id, <span style="color:#e6db74">&#39;SK&#39;</span>: <span style="color:#e6db74">&#39;DETAILS&#39;</span>}
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>cache_manager<span style="color:#f92672">.</span>update_item_with_cache(key, updates)
</code></pre></div><h3 id="step-2-cache-performance-testing">Step 2: Cache Performance Testing</h3>
<p><strong>Test caching effectiveness</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Initialize cached repository</span>
cached_repo <span style="color:#f92672">=</span> CachedProductRepository(<span style="color:#e6db74">&#39;demo-ecommerce-freetier&#39;</span>, cache_ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">60</span>)

<span style="color:#75715e"># Performance comparison</span>
<span style="color:#f92672">import</span> time

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_cache_performance</span>(product_id: str, iterations: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Compare cached vs non-cached performance
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Testing cache performance with </span><span style="color:#e6db74">{</span>iterations<span style="color:#e6db74">}</span><span style="color:#e6db74"> iterations...&#34;</span>)
    
    <span style="color:#75715e"># Test cached access</span>
    start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(iterations):
        result <span style="color:#f92672">=</span> cached_repo<span style="color:#f92672">.</span>get_product_cached(product_id)
        
    cached_duration <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start_time
    
    <span style="color:#75715e"># Test direct access (non-cached)</span>
    start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(iterations):
        result <span style="color:#f92672">=</span> cached_repo<span style="color:#f92672">.</span>get_product(product_id)
        
    direct_duration <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start_time
    
    <span style="color:#75715e"># Cache statistics</span>
    stats <span style="color:#f92672">=</span> cached_repo<span style="color:#f92672">.</span>cache_manager<span style="color:#f92672">.</span>get_cache_stats()
    
    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Cached access: </span><span style="color:#e6db74">{</span>cached_duration<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">s&#34;</span>)
    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Direct access: </span><span style="color:#e6db74">{</span>direct_duration<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">s&#34;</span>)
    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Performance improvement: </span><span style="color:#e6db74">{</span>direct_duration<span style="color:#f92672">/</span>cached_duration<span style="color:#e6db74">:</span><span style="color:#e6db74">.1f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">x&#34;</span>)
    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Cache hit rate: </span><span style="color:#e6db74">{</span>stats[<span style="color:#e6db74">&#39;hit_rate_percent&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">%&#34;</span>)
    
    <span style="color:#66d9ef">return</span> stats

<span style="color:#75715e"># Run performance test</span>
<span style="color:#66d9ef">if</span> laptop_result[<span style="color:#e6db74">&#39;success&#39;</span>]:
    stats <span style="color:#f92672">=</span> test_cache_performance(laptop_result[<span style="color:#e6db74">&#39;item&#39;</span>][<span style="color:#e6db74">&#39;PK&#39;</span>])
</code></pre></div>
<div class="notices info" ><p><strong>Screenshot Location</strong>: Add screenshot showing cache performance comparison results</p>
</div>

<h2 id="exercise-3-error-handling-and-resilience">Exercise 3: Error Handling and Resilience</h2>
<h3 id="step-1-comprehensive-error-handling">Step 1: Comprehensive Error Handling</h3>
<p><strong>Implement production-grade error handling</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> time
<span style="color:#f92672">import</span> random
<span style="color:#f92672">from</span> enum <span style="color:#f92672">import</span> Enum
<span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Dict, Any, Callable

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DynamoDBErrorType</span>(Enum):
    THROTTLING <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ProvisionedThroughputExceededException&#34;</span>
    CONDITIONAL_FAILED <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ConditionalCheckFailedException&#34;</span>
    ITEM_NOT_FOUND <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ResourceNotFoundException&#34;</span>
    VALIDATION_ERROR <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ValidationException&#34;</span>
    NETWORK_ERROR <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;NetworkError&#34;</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ResilientDynamoDBClient</span>:
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Production resilient DynamoDB client with retry logic
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    <span style="color:#66d9ef">def</span> __init__(self, repository: DynamoDBRepository, max_retries: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>):
        self<span style="color:#f92672">.</span>repository <span style="color:#f92672">=</span> repository
        self<span style="color:#f92672">.</span>max_retries <span style="color:#f92672">=</span> max_retries
        self<span style="color:#f92672">.</span>retry_stats <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;total_attempts&#39;</span>: <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;retries&#39;</span>: <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;failures&#39;</span>: <span style="color:#ae81ff">0</span>}
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">execute_with_retry</span>(self, operation: Callable, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Execute operation with exponential backoff retry
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        self<span style="color:#f92672">.</span>retry_stats[<span style="color:#e6db74">&#39;total_attempts&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
        
        <span style="color:#66d9ef">for</span> attempt <span style="color:#f92672">in</span> range(self<span style="color:#f92672">.</span>max_retries <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
            <span style="color:#66d9ef">try</span>:
                result <span style="color:#f92672">=</span> operation(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs)
                
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> result[<span style="color:#e6db74">&#39;success&#39;</span>]:
                    error_code <span style="color:#f92672">=</span> result<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;error_code&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>)
                    
                    <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>_should_retry(error_code) <span style="color:#f92672">and</span> attempt <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>max_retries:
                        wait_time <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_calculate_backoff(attempt)
                        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Attempt </span><span style="color:#e6db74">{</span>attempt <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> failed, retrying in </span><span style="color:#e6db74">{</span>wait_time<span style="color:#e6db74">}</span><span style="color:#e6db74">s...&#34;</span>)
                        time<span style="color:#f92672">.</span>sleep(wait_time)
                        self<span style="color:#f92672">.</span>retry_stats[<span style="color:#e6db74">&#39;retries&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                        <span style="color:#66d9ef">continue</span>
                    <span style="color:#66d9ef">else</span>:
                        self<span style="color:#f92672">.</span>retry_stats[<span style="color:#e6db74">&#39;failures&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_handle_final_error(result, attempt <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
                
                <span style="color:#66d9ef">return</span> result
                
            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
                <span style="color:#66d9ef">if</span> attempt <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>max_retries:
                    wait_time <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_calculate_backoff(attempt)
                    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Exception on attempt </span><span style="color:#e6db74">{</span>attempt <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">}</span><span style="color:#e6db74">, retrying in </span><span style="color:#e6db74">{</span>wait_time<span style="color:#e6db74">}</span><span style="color:#e6db74">s...&#34;</span>)
                    time<span style="color:#f92672">.</span>sleep(wait_time)
                    self<span style="color:#f92672">.</span>retry_stats[<span style="color:#e6db74">&#39;retries&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                    <span style="color:#66d9ef">continue</span>
                <span style="color:#66d9ef">else</span>:
                    self<span style="color:#f92672">.</span>retry_stats[<span style="color:#e6db74">&#39;failures&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                    <span style="color:#66d9ef">return</span> {
                        <span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">False</span>,
                        <span style="color:#e6db74">&#39;error_code&#39;</span>: <span style="color:#e6db74">&#39;UnexpectedError&#39;</span>,
                        <span style="color:#e6db74">&#39;error_message&#39;</span>: str(e),
                        <span style="color:#e6db74">&#39;attempts&#39;</span>: attempt <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
                    }
        
        <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">False</span>, <span style="color:#e6db74">&#39;error_code&#39;</span>: <span style="color:#e6db74">&#39;MaxRetriesExceeded&#39;</span>}
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_should_retry</span>(self, error_code: str) <span style="color:#f92672">-&gt;</span> bool:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Determine if error is retryable
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        retryable_errors <span style="color:#f92672">=</span> {
            <span style="color:#e6db74">&#39;ProvisionedThroughputExceededException&#39;</span>,
            <span style="color:#e6db74">&#39;ThrottlingException&#39;</span>,
            <span style="color:#e6db74">&#39;RequestLimitExceeded&#39;</span>,
            <span style="color:#e6db74">&#39;InternalServerError&#39;</span>,
            <span style="color:#e6db74">&#39;ServiceUnavailable&#39;</span>
        }
        <span style="color:#66d9ef">return</span> error_code <span style="color:#f92672">in</span> retryable_errors
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_calculate_backoff</span>(self, attempt: int) <span style="color:#f92672">-&gt;</span> float:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Calculate exponential backoff with jitter
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        base_wait <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> attempt
        jitter <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">0.5</span>)
        <span style="color:#66d9ef">return</span> base_wait <span style="color:#f92672">+</span> jitter
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_handle_final_error</span>(self, result: Dict, attempts: int) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Handle final error with context
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        error_code <span style="color:#f92672">=</span> result<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;error_code&#39;</span>, <span style="color:#e6db74">&#39;Unknown&#39;</span>)
        
        error_context <span style="color:#f92672">=</span> {
            <span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">False</span>,
            <span style="color:#e6db74">&#39;error_code&#39;</span>: error_code,
            <span style="color:#e6db74">&#39;error_message&#39;</span>: result<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;error_message&#39;</span>, <span style="color:#e6db74">&#39;Operation failed&#39;</span>),
            <span style="color:#e6db74">&#39;attempts&#39;</span>: attempts,
            <span style="color:#e6db74">&#39;retry_exhausted&#39;</span>: attempts <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>,
            <span style="color:#e6db74">&#39;recommendation&#39;</span>: self<span style="color:#f92672">.</span>_get_error_recommendation(error_code)
        }
        
        <span style="color:#66d9ef">return</span> error_context
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_error_recommendation</span>(self, error_code: str) <span style="color:#f92672">-&gt;</span> str:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Provide actionable error recommendations
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        recommendations <span style="color:#f92672">=</span> {
            <span style="color:#e6db74">&#39;ConditionalCheckFailedException&#39;</span>: <span style="color:#e6db74">&#39;Data was modified by another process. Retry with fresh data.&#39;</span>,
            <span style="color:#e6db74">&#39;ProvisionedThroughputExceededException&#39;</span>: <span style="color:#e6db74">&#39;Increase table capacity or enable auto-scaling.&#39;</span>,
            <span style="color:#e6db74">&#39;ValidationException&#39;</span>: <span style="color:#e6db74">&#39;Check request parameters and data types.&#39;</span>,
            <span style="color:#e6db74">&#39;ResourceNotFoundException&#39;</span>: <span style="color:#e6db74">&#39;Verify table/index exists and spelling is correct.&#39;</span>,
            <span style="color:#e6db74">&#39;ItemCollectionSizeLimitExceededException&#39;</span>: <span style="color:#e6db74">&#39;Partition has too much data. Consider data redistribution.&#39;</span>
        }
        
        <span style="color:#66d9ef">return</span> recommendations<span style="color:#f92672">.</span>get(error_code, <span style="color:#e6db74">&#39;Review error details and DynamoDB documentation.&#39;</span>)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_retry_stats</span>(self) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Get retry statistics for monitoring
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        total <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>retry_stats[<span style="color:#e6db74">&#39;total_attempts&#39;</span>]
        retries <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>retry_stats[<span style="color:#e6db74">&#39;retries&#39;</span>]
        failures <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>retry_stats[<span style="color:#e6db74">&#39;failures&#39;</span>]
        
        <span style="color:#66d9ef">return</span> {
            <span style="color:#f92672">**</span>self<span style="color:#f92672">.</span>retry_stats,
            <span style="color:#e6db74">&#39;retry_rate&#39;</span>: round(retries <span style="color:#f92672">/</span> max(total, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">2</span>),
            <span style="color:#e6db74">&#39;failure_rate&#39;</span>: round(failures <span style="color:#f92672">/</span> max(total, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">2</span>)
        }

<span style="color:#75715e"># Usage example</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ProductService</span>:
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Business service with resilient DynamoDB operations
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    <span style="color:#66d9ef">def</span> __init__(self, table_name: str):
        self<span style="color:#f92672">.</span>repository <span style="color:#f92672">=</span> ProductRepository(table_name)
        self<span style="color:#f92672">.</span>resilient_client <span style="color:#f92672">=</span> ResilientDynamoDBClient(self<span style="color:#f92672">.</span>repository)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_product_safely</span>(self, product_data: Dict[str, Any]) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Create product with retry logic
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>resilient_client<span style="color:#f92672">.</span>execute_with_retry(
            self<span style="color:#f92672">.</span>repository<span style="color:#f92672">.</span>create_product,
            product_data
        )
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update_stock_safely</span>(self, product_id: str, quantity_change: int) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Update stock with resilient error handling
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>resilient_client<span style="color:#f92672">.</span>execute_with_retry(
            self<span style="color:#f92672">.</span>repository<span style="color:#f92672">.</span>update_product_stock,
            product_id,
            quantity_change
        )
</code></pre></div><h3 id="step-2-circuit-breaker-pattern">Step 2: Circuit Breaker Pattern</h3>
<p><strong>Implement circuit breaker for service protection</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> time
<span style="color:#f92672">from</span> enum <span style="color:#f92672">import</span> Enum

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CircuitState</span>(Enum):
    CLOSED <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;closed&#34;</span>      <span style="color:#75715e"># Normal operation</span>
    OPEN <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;open&#34;</span>          <span style="color:#75715e"># Failing, reject requests</span>
    HALF_OPEN <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;half_open&#34;</span> <span style="color:#75715e"># Testing if service recovered</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CircuitBreaker</span>:
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Circuit breaker pattern for DynamoDB operations
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    <span style="color:#66d9ef">def</span> __init__(self, failure_threshold: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>, timeout: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">60</span>):
        self<span style="color:#f92672">.</span>failure_threshold <span style="color:#f92672">=</span> failure_threshold
        self<span style="color:#f92672">.</span>timeout <span style="color:#f92672">=</span> timeout
        self<span style="color:#f92672">.</span>failure_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        self<span style="color:#f92672">.</span>last_failure_time <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
        self<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> CircuitState<span style="color:#f92672">.</span>CLOSED
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">call</span>(self, operation: Callable, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Execute operation through circuit breaker
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>state <span style="color:#f92672">==</span> CircuitState<span style="color:#f92672">.</span>OPEN:
            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>_should_attempt_reset():
                self<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> CircuitState<span style="color:#f92672">.</span>HALF_OPEN
                print(<span style="color:#e6db74">&#34;Circuit breaker moving to HALF_OPEN state&#34;</span>)
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">return</span> {
                    <span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">False</span>,
                    <span style="color:#e6db74">&#39;error_code&#39;</span>: <span style="color:#e6db74">&#39;CircuitBreakerOpen&#39;</span>,
                    <span style="color:#e6db74">&#39;error_message&#39;</span>: <span style="color:#e6db74">&#39;Service temporarily unavailable&#39;</span>
                }
        
        <span style="color:#66d9ef">try</span>:
            result <span style="color:#f92672">=</span> operation(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs)
            
            <span style="color:#66d9ef">if</span> result[<span style="color:#e6db74">&#39;success&#39;</span>]:
                self<span style="color:#f92672">.</span>_on_success()
            <span style="color:#66d9ef">else</span>:
                self<span style="color:#f92672">.</span>_on_failure()
            
            <span style="color:#66d9ef">return</span> result
            
        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
            self<span style="color:#f92672">.</span>_on_failure()
            <span style="color:#66d9ef">return</span> {
                <span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">False</span>,
                <span style="color:#e6db74">&#39;error_code&#39;</span>: <span style="color:#e6db74">&#39;ServiceError&#39;</span>,
                <span style="color:#e6db74">&#39;error_message&#39;</span>: str(e)
            }
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_should_attempt_reset</span>(self) <span style="color:#f92672">-&gt;</span> bool:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Check if enough time has passed to attempt reset
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">return</span> (time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> self<span style="color:#f92672">.</span>last_failure_time) <span style="color:#f92672">&gt;=</span> self<span style="color:#f92672">.</span>timeout
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_on_success</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Handle successful operation
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        self<span style="color:#f92672">.</span>failure_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        self<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> CircuitState<span style="color:#f92672">.</span>CLOSED
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_on_failure</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Handle failed operation
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        self<span style="color:#f92672">.</span>failure_count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
        self<span style="color:#f92672">.</span>last_failure_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
        
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>failure_count <span style="color:#f92672">&gt;=</span> self<span style="color:#f92672">.</span>failure_threshold:
            self<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> CircuitState<span style="color:#f92672">.</span>OPEN
            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Circuit breaker OPEN after </span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>failure_count<span style="color:#e6db74">}</span><span style="color:#e6db74"> failures&#34;</span>)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_state</span>(self) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Get current circuit breaker state
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">return</span> {
            <span style="color:#e6db74">&#39;state&#39;</span>: self<span style="color:#f92672">.</span>state<span style="color:#f92672">.</span>value,
            <span style="color:#e6db74">&#39;failure_count&#39;</span>: self<span style="color:#f92672">.</span>failure_count,
            <span style="color:#e6db74">&#39;failure_threshold&#39;</span>: self<span style="color:#f92672">.</span>failure_threshold,
            <span style="color:#e6db74">&#39;last_failure&#39;</span>: self<span style="color:#f92672">.</span>last_failure_time
        }
</code></pre></div>
<div class="notices info" ><p><strong>Screenshot Location</strong>: Add screenshot showing circuit breaker implementation and state management</p>
</div>

<h2 id="exercise-4-connection-pool-and-resource-management">Exercise 4: Connection Pool and Resource Management</h2>
<h3 id="step-1-connection-pool-implementation">Step 1: Connection Pool Implementation</h3>
<p><strong>Optimize resource usage with connection pooling</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> boto3
<span style="color:#f92672">from</span> botocore.config <span style="color:#f92672">import</span> Config
<span style="color:#f92672">import</span> threading
<span style="color:#f92672">from</span> queue <span style="color:#f92672">import</span> Queue

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DynamoDBConnectionPool</span>:
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Production connection pool for DynamoDB clients
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    <span style="color:#66d9ef">def</span> __init__(self, max_connections: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>, region: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;us-east-1&#39;</span>):
        self<span style="color:#f92672">.</span>max_connections <span style="color:#f92672">=</span> max_connections
        self<span style="color:#f92672">.</span>region <span style="color:#f92672">=</span> region
        self<span style="color:#f92672">.</span>pool <span style="color:#f92672">=</span> Queue(maxsize<span style="color:#f92672">=</span>max_connections)
        self<span style="color:#f92672">.</span>lock <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Lock()
        self<span style="color:#f92672">.</span>active_connections <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        
        <span style="color:#75715e"># Pre-create connections</span>
        <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(max_connections):
            client <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_create_client()
            self<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>put(client)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_create_client</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Create optimized DynamoDB client
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        config <span style="color:#f92672">=</span> Config(
            retries<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;max_attempts&#39;</span>: <span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;mode&#39;</span>: <span style="color:#e6db74">&#39;adaptive&#39;</span>},
            max_pool_connections<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>,
            connect_timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>,
            read_timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>
        )
        
        <span style="color:#66d9ef">return</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;dynamodb&#39;</span>, region_name<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>region, config<span style="color:#f92672">=</span>config)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_client</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Get client from pool (context manager)
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">return</span> ConnectionContextManager(self)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_acquire</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Acquire client from pool
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">with</span> self<span style="color:#f92672">.</span>lock:
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>empty():
                client <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>get()
                self<span style="color:#f92672">.</span>active_connections <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                <span style="color:#66d9ef">return</span> client
            <span style="color:#66d9ef">elif</span> self<span style="color:#f92672">.</span>active_connections <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>max_connections:
                client <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_create_client()
                self<span style="color:#f92672">.</span>active_connections <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                <span style="color:#66d9ef">return</span> client
            <span style="color:#66d9ef">else</span>:
                <span style="color:#75715e"># Wait for available connection</span>
                client <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>get(block<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>)
                <span style="color:#66d9ef">return</span> client
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_release</span>(self, client):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Return client to pool
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">with</span> self<span style="color:#f92672">.</span>lock:
            self<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>put(client)
            self<span style="color:#f92672">.</span>active_connections <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_stats</span>(self) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Get connection pool statistics
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">return</span> {
            <span style="color:#e6db74">&#39;max_connections&#39;</span>: self<span style="color:#f92672">.</span>max_connections,
            <span style="color:#e6db74">&#39;active_connections&#39;</span>: self<span style="color:#f92672">.</span>active_connections,
            <span style="color:#e6db74">&#39;available_connections&#39;</span>: self<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>qsize(),
            <span style="color:#e6db74">&#39;pool_utilization&#39;</span>: round(self<span style="color:#f92672">.</span>active_connections <span style="color:#f92672">/</span> self<span style="color:#f92672">.</span>max_connections <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">2</span>)
        }

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConnectionContextManager</span>:
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Context manager for connection pool usage
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    <span style="color:#66d9ef">def</span> __init__(self, pool: DynamoDBConnectionPool):
        self<span style="color:#f92672">.</span>pool <span style="color:#f92672">=</span> pool
        self<span style="color:#f92672">.</span>client <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
    
    <span style="color:#66d9ef">def</span> __enter__(self):
        self<span style="color:#f92672">.</span>client <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>_acquire()
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>client
    
    <span style="color:#66d9ef">def</span> __exit__(self, exc_type, exc_val, exc_tb):
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>client:
            self<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>_release(self<span style="color:#f92672">.</span>client)

<span style="color:#75715e"># Enterprise repository with connection pooling</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EnterpriseProductRepository</span>:
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Enterprise-grade repository with connection pooling
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    <span style="color:#66d9ef">def</span> __init__(self, table_name: str, connection_pool: DynamoDBConnectionPool):
        self<span style="color:#f92672">.</span>table_name <span style="color:#f92672">=</span> table_name
        self<span style="color:#f92672">.</span>pool <span style="color:#f92672">=</span> connection_pool
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_product_pooled</span>(self, product_id: str) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Get product using connection pool
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">try</span>:
            <span style="color:#66d9ef">with</span> self<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>get_client() <span style="color:#66d9ef">as</span> client:
                response <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>get_item(
                    TableName<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>table_name,
                    Key<span style="color:#f92672">=</span>{
                        <span style="color:#e6db74">&#39;PK&#39;</span>: {<span style="color:#e6db74">&#39;S&#39;</span>: product_id},
                        <span style="color:#e6db74">&#39;SK&#39;</span>: {<span style="color:#e6db74">&#39;S&#39;</span>: <span style="color:#e6db74">&#39;DETAILS&#39;</span>}
                    }
                )
                
                <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;Item&#39;</span> <span style="color:#f92672">in</span> response:
                    <span style="color:#66d9ef">return</span> {
                        <span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">True</span>,
                        <span style="color:#e6db74">&#39;item&#39;</span>: response[<span style="color:#e6db74">&#39;Item&#39;</span>],
                        <span style="color:#e6db74">&#39;pool_stats&#39;</span>: self<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>get_stats()
                    }
                <span style="color:#66d9ef">else</span>:
                    <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">False</span>, <span style="color:#e6db74">&#39;error&#39;</span>: <span style="color:#e6db74">&#39;Item not found&#39;</span>}
                    
        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
            <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">False</span>, <span style="color:#e6db74">&#39;error&#39;</span>: str(e)}
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">batch_get_products</span>(self, product_ids: List[str]) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Batch get products with connection pooling
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">try</span>:
            <span style="color:#66d9ef">with</span> self<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>get_client() <span style="color:#66d9ef">as</span> client:
                keys <span style="color:#f92672">=</span> [
                    {<span style="color:#e6db74">&#39;PK&#39;</span>: {<span style="color:#e6db74">&#39;S&#39;</span>: pid}, <span style="color:#e6db74">&#39;SK&#39;</span>: {<span style="color:#e6db74">&#39;S&#39;</span>: <span style="color:#e6db74">&#39;DETAILS&#39;</span>}}
                    <span style="color:#66d9ef">for</span> pid <span style="color:#f92672">in</span> product_ids
                ]
                
                response <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>batch_get_item(
                    RequestItems<span style="color:#f92672">=</span>{
                        self<span style="color:#f92672">.</span>table_name: {<span style="color:#e6db74">&#39;Keys&#39;</span>: keys}
                    }
                )
                
                items <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;Responses&#39;</span>, {})<span style="color:#f92672">.</span>get(self<span style="color:#f92672">.</span>table_name, [])
                
                <span style="color:#66d9ef">return</span> {
                    <span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">True</span>,
                    <span style="color:#e6db74">&#39;items&#39;</span>: items,
                    <span style="color:#e6db74">&#39;count&#39;</span>: len(items),
                    <span style="color:#e6db74">&#39;pool_stats&#39;</span>: self<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>get_stats()
                }
                
        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
            <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">False</span>, <span style="color:#e6db74">&#39;error&#39;</span>: str(e)}
</code></pre></div><h3 id="step-2-resource-optimization-testing">Step 2: Resource Optimization Testing</h3>
<p><strong>Test connection pool efficiency</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Initialize connection pool</span>
connection_pool <span style="color:#f92672">=</span> DynamoDBConnectionPool(max_connections<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>)
enterprise_repo <span style="color:#f92672">=</span> EnterpriseProductRepository(<span style="color:#e6db74">&#39;demo-ecommerce-freetier&#39;</span>, connection_pool)

<span style="color:#75715e"># Test concurrent access</span>
<span style="color:#f92672">import</span> concurrent.futures
<span style="color:#f92672">import</span> time

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_concurrent_access</span>(num_threads: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>, requests_per_thread: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Test connection pool under concurrent load
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Testing with </span><span style="color:#e6db74">{</span>num_threads<span style="color:#e6db74">}</span><span style="color:#e6db74"> threads, </span><span style="color:#e6db74">{</span>requests_per_thread<span style="color:#e6db74">}</span><span style="color:#e6db74"> requests each&#34;</span>)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">worker_thread</span>(thread_id: int):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Worker thread for testing
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        results <span style="color:#f92672">=</span> []
        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(requests_per_thread):
            <span style="color:#66d9ef">if</span> laptop_result[<span style="color:#e6db74">&#39;success&#39;</span>]:
                result <span style="color:#f92672">=</span> enterprise_repo<span style="color:#f92672">.</span>get_product_pooled(laptop_result[<span style="color:#e6db74">&#39;item&#39;</span>][<span style="color:#e6db74">&#39;PK&#39;</span>])
                results<span style="color:#f92672">.</span>append(result[<span style="color:#e6db74">&#39;success&#39;</span>])
        <span style="color:#66d9ef">return</span> sum(results)
    
    start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
    
    <span style="color:#66d9ef">with</span> concurrent<span style="color:#f92672">.</span>futures<span style="color:#f92672">.</span>ThreadPoolExecutor(max_workers<span style="color:#f92672">=</span>num_threads) <span style="color:#66d9ef">as</span> executor:
        futures <span style="color:#f92672">=</span> [
            executor<span style="color:#f92672">.</span>submit(worker_thread, i) 
            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(num_threads)
        ]
        
        total_successes <span style="color:#f92672">=</span> sum(future<span style="color:#f92672">.</span>result() <span style="color:#66d9ef">for</span> future <span style="color:#f92672">in</span> futures)
    
    duration <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start_time
    total_requests <span style="color:#f92672">=</span> num_threads <span style="color:#f92672">*</span> requests_per_thread
    
    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Completed </span><span style="color:#e6db74">{</span>total_requests<span style="color:#e6db74">}</span><span style="color:#e6db74"> requests in </span><span style="color:#e6db74">{</span>duration<span style="color:#e6db74">:</span><span style="color:#e6db74">.2f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">s&#34;</span>)
    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Success rate: </span><span style="color:#e6db74">{</span>total_successes<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>total_requests<span style="color:#e6db74">}</span><span style="color:#e6db74"> (</span><span style="color:#e6db74">{</span>total_successes<span style="color:#f92672">/</span>total_requests<span style="color:#f92672">*</span><span style="color:#ae81ff">100</span><span style="color:#e6db74">:</span><span style="color:#e6db74">.1f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">%)&#34;</span>)
    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Throughput: </span><span style="color:#e6db74">{</span>total_requests<span style="color:#f92672">/</span>duration<span style="color:#e6db74">:</span><span style="color:#e6db74">.1f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> requests/second&#34;</span>)
    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Pool stats: </span><span style="color:#e6db74">{</span>connection_pool<span style="color:#f92672">.</span>get_stats()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)

<span style="color:#75715e"># Run concurrent test</span>
test_concurrent_access(num_threads<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>, requests_per_thread<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>)
</code></pre></div>
<div class="notices info" ><p><strong>Screenshot Location</strong>: Add screenshot showing concurrent access test results and pool statistics</p>
</div>

<h2 id="exercise-5-production-monitoring-and-observability">Exercise 5: Production Monitoring and Observability</h2>
<h3 id="step-1-comprehensive-metrics-collection">Step 1: Comprehensive Metrics Collection</h3>
<p><strong>Implement production monitoring</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> time
<span style="color:#f92672">import</span> json
<span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime
<span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Dict, Any
<span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> defaultdict

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DynamoDBMetricsCollector</span>:
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Production metrics collection for DynamoDB operations
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    <span style="color:#66d9ef">def</span> __init__(self):
        self<span style="color:#f92672">.</span>metrics <span style="color:#f92672">=</span> defaultdict(list)
        self<span style="color:#f92672">.</span>operation_counts <span style="color:#f92672">=</span> defaultdict(int)
        self<span style="color:#f92672">.</span>error_counts <span style="color:#f92672">=</span> defaultdict(int)
        self<span style="color:#f92672">.</span>start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">record_operation</span>(self, operation: str, duration: float, success: bool, 
                        consumed_capacity: float <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, error_code: str <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Record operation metrics
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        timestamp <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>utcnow()<span style="color:#f92672">.</span>isoformat()
        
        metric <span style="color:#f92672">=</span> {
            <span style="color:#e6db74">&#39;timestamp&#39;</span>: timestamp,
            <span style="color:#e6db74">&#39;operation&#39;</span>: operation,
            <span style="color:#e6db74">&#39;duration_ms&#39;</span>: round(duration <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span>, <span style="color:#ae81ff">2</span>),
            <span style="color:#e6db74">&#39;success&#39;</span>: success,
            <span style="color:#e6db74">&#39;consumed_capacity&#39;</span>: consumed_capacity,
            <span style="color:#e6db74">&#39;error_code&#39;</span>: error_code
        }
        
        self<span style="color:#f92672">.</span>metrics[operation]<span style="color:#f92672">.</span>append(metric)
        self<span style="color:#f92672">.</span>operation_counts[operation] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
        
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> success <span style="color:#f92672">and</span> error_code:
            self<span style="color:#f92672">.</span>error_counts[error_code] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_operation_stats</span>(self, operation: str) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Get statistics for specific operation
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        ops <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>metrics[operation]
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> ops:
            <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;error&#39;</span>: <span style="color:#e6db74">&#39;No data for operation&#39;</span>}
        
        durations <span style="color:#f92672">=</span> [op[<span style="color:#e6db74">&#39;duration_ms&#39;</span>] <span style="color:#66d9ef">for</span> op <span style="color:#f92672">in</span> ops]
        successes <span style="color:#f92672">=</span> [op <span style="color:#66d9ef">for</span> op <span style="color:#f92672">in</span> ops <span style="color:#66d9ef">if</span> op[<span style="color:#e6db74">&#39;success&#39;</span>]]
        
        <span style="color:#66d9ef">return</span> {
            <span style="color:#e6db74">&#39;operation&#39;</span>: operation,
            <span style="color:#e6db74">&#39;total_requests&#39;</span>: len(ops),
            <span style="color:#e6db74">&#39;successful_requests&#39;</span>: len(successes),
            <span style="color:#e6db74">&#39;success_rate&#39;</span>: round(len(successes) <span style="color:#f92672">/</span> len(ops) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">2</span>),
            <span style="color:#e6db74">&#39;avg_duration_ms&#39;</span>: round(sum(durations) <span style="color:#f92672">/</span> len(durations), <span style="color:#ae81ff">2</span>),
            <span style="color:#e6db74">&#39;min_duration_ms&#39;</span>: min(durations),
            <span style="color:#e6db74">&#39;max_duration_ms&#39;</span>: max(durations),
            <span style="color:#e6db74">&#39;p95_duration_ms&#39;</span>: self<span style="color:#f92672">.</span>_percentile(durations, <span style="color:#ae81ff">95</span>),
            <span style="color:#e6db74">&#39;total_capacity_consumed&#39;</span>: sum(op[<span style="color:#e6db74">&#39;consumed_capacity&#39;</span>] <span style="color:#66d9ef">for</span> op <span style="color:#f92672">in</span> ops)
        }
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_overall_stats</span>(self) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Get comprehensive system statistics
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        uptime <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> self<span style="color:#f92672">.</span>start_time
        total_operations <span style="color:#f92672">=</span> sum(self<span style="color:#f92672">.</span>operation_counts<span style="color:#f92672">.</span>values())
        total_errors <span style="color:#f92672">=</span> sum(self<span style="color:#f92672">.</span>error_counts<span style="color:#f92672">.</span>values())
        
        <span style="color:#66d9ef">return</span> {
            <span style="color:#e6db74">&#39;uptime_seconds&#39;</span>: round(uptime, <span style="color:#ae81ff">2</span>),
            <span style="color:#e6db74">&#39;total_operations&#39;</span>: total_operations,
            <span style="color:#e6db74">&#39;total_errors&#39;</span>: total_errors,
            <span style="color:#e6db74">&#39;error_rate&#39;</span>: round(total_errors <span style="color:#f92672">/</span> max(total_operations, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">2</span>),
            <span style="color:#e6db74">&#39;operations_per_second&#39;</span>: round(total_operations <span style="color:#f92672">/</span> uptime, <span style="color:#ae81ff">2</span>),
            <span style="color:#e6db74">&#39;operation_breakdown&#39;</span>: dict(self<span style="color:#f92672">.</span>operation_counts),
            <span style="color:#e6db74">&#39;error_breakdown&#39;</span>: dict(self<span style="color:#f92672">.</span>error_counts)
        }
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_percentile</span>(self, data: List[float], percentile: int) <span style="color:#f92672">-&gt;</span> float:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Calculate percentile value
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        sorted_data <span style="color:#f92672">=</span> sorted(data)
        index <span style="color:#f92672">=</span> int(len(sorted_data) <span style="color:#f92672">*</span> percentile <span style="color:#f92672">/</span> <span style="color:#ae81ff">100</span>)
        <span style="color:#66d9ef">return</span> sorted_data[min(index, len(sorted_data) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)]
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">export_metrics</span>(self) <span style="color:#f92672">-&gt;</span> str:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Export metrics in JSON format
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>dumps({
            <span style="color:#e6db74">&#39;overall_stats&#39;</span>: self<span style="color:#f92672">.</span>get_overall_stats(),
            <span style="color:#e6db74">&#39;operation_stats&#39;</span>: {
                op: self<span style="color:#f92672">.</span>get_operation_stats(op) 
                <span style="color:#66d9ef">for</span> op <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>keys()
            },
            <span style="color:#e6db74">&#39;raw_metrics&#39;</span>: dict(self<span style="color:#f92672">.</span>metrics)
        }, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MonitoredProductRepository</span>(ProductRepository):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Product repository with integrated monitoring
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    <span style="color:#66d9ef">def</span> __init__(self, table_name: str):
        super()<span style="color:#f92672">.</span>__init__(table_name)
        self<span style="color:#f92672">.</span>metrics <span style="color:#f92672">=</span> DynamoDBMetricsCollector()
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_product_monitored</span>(self, product_id: str) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Get product with metrics collection
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
        
        <span style="color:#66d9ef">try</span>:
            result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>get_product(product_id)
            duration <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start_time
            
            self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>record_operation(
                operation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;get_product&#39;</span>,
                duration<span style="color:#f92672">=</span>duration,
                success<span style="color:#f92672">=</span>result[<span style="color:#e6db74">&#39;success&#39;</span>],
                consumed_capacity<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>,  <span style="color:#75715e"># Estimate for GetItem</span>
                error_code<span style="color:#f92672">=</span>result<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;error_code&#39;</span>)
            )
            
            <span style="color:#66d9ef">return</span> result
            
        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
            duration <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start_time
            self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>record_operation(
                operation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;get_product&#39;</span>,
                duration<span style="color:#f92672">=</span>duration,
                success<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
                error_code<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;UnexpectedError&#39;</span>
            )
            <span style="color:#66d9ef">raise</span>
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_product_monitored</span>(self, product_data: Dict[str, Any]) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Create product with metrics collection
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
        
        <span style="color:#66d9ef">try</span>:
            result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>create_product(product_data)
            duration <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start_time
            
            self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>record_operation(
                operation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;create_product&#39;</span>,
                duration<span style="color:#f92672">=</span>duration,
                success<span style="color:#f92672">=</span>result[<span style="color:#e6db74">&#39;success&#39;</span>],
                consumed_capacity<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0</span>,  <span style="color:#75715e"># Estimate for PutItem</span>
                error_code<span style="color:#f92672">=</span>result<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;error_code&#39;</span>)
            )
            
            <span style="color:#66d9ef">return</span> result
            
        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
            duration <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start_time
            self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>record_operation(
                operation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;create_product&#39;</span>,
                duration<span style="color:#f92672">=</span>duration,
                success<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
                error_code<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;UnexpectedError&#39;</span>
            )
            <span style="color:#66d9ef">raise</span>
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_performance_report</span>(self) <span style="color:#f92672">-&gt;</span> Dict:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Generate comprehensive performance report
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">return</span> {
            <span style="color:#e6db74">&#39;timestamp&#39;</span>: datetime<span style="color:#f92672">.</span>utcnow()<span style="color:#f92672">.</span>isoformat(),
            <span style="color:#e6db74">&#39;repository_metrics&#39;</span>: self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>get_overall_stats(),
            <span style="color:#e6db74">&#39;operation_details&#39;</span>: {
                <span style="color:#e6db74">&#39;get_product&#39;</span>: self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>get_operation_stats(<span style="color:#e6db74">&#39;get_product&#39;</span>),
                <span style="color:#e6db74">&#39;create_product&#39;</span>: self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>get_operation_stats(<span style="color:#e6db74">&#39;create_product&#39;</span>)
            }
        }
</code></pre></div><h3 id="step-2-performance-monitoring-demo">Step 2: Performance Monitoring Demo</h3>
<p><strong>Demonstrate production monitoring capabilities</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Initialize monitored repository</span>
monitored_repo <span style="color:#f92672">=</span> MonitoredProductRepository(<span style="color:#e6db74">&#39;demo-ecommerce-freetier&#39;</span>)

<span style="color:#75715e"># Generate sample operations for monitoring</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">simulate_production_traffic</span>():
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Simulate production traffic patterns
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    print(<span style="color:#e6db74">&#34;Simulating production traffic...&#34;</span>)
    
    <span style="color:#75715e"># Create several products</span>
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">5</span>):
        result <span style="color:#f92672">=</span> monitored_repo<span style="color:#f92672">.</span>create_product_monitored({
            <span style="color:#e6db74">&#39;name&#39;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;Monitored Product </span><span style="color:#e6db74">{</span>i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>,
            <span style="color:#e6db74">&#39;price&#39;</span>: <span style="color:#ae81ff">100</span> <span style="color:#f92672">+</span> i <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>,
            <span style="color:#e6db74">&#39;stock&#39;</span>: <span style="color:#ae81ff">20</span>,
            <span style="color:#e6db74">&#39;category&#39;</span>: <span style="color:#e6db74">&#39;monitoring-test&#39;</span>
        })
        
        <span style="color:#66d9ef">if</span> result[<span style="color:#e6db74">&#39;success&#39;</span>]:
            product_id <span style="color:#f92672">=</span> result[<span style="color:#e6db74">&#39;item&#39;</span>][<span style="color:#e6db74">&#39;PK&#39;</span>]
            
            <span style="color:#75715e"># Read the product multiple times (simulating user traffic)</span>
            <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">3</span>):
                monitored_repo<span style="color:#f92672">.</span>get_product_monitored(product_id)
    
    <span style="color:#75715e"># Generate performance report</span>
    report <span style="color:#f92672">=</span> monitored_repo<span style="color:#f92672">.</span>get_performance_report()
    
    print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">=== PERFORMANCE REPORT ===&#34;</span>)
    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Total Operations: </span><span style="color:#e6db74">{</span>report[<span style="color:#e6db74">&#39;repository_metrics&#39;</span>][<span style="color:#e6db74">&#39;total_operations&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error Rate: </span><span style="color:#e6db74">{</span>report[<span style="color:#e6db74">&#39;repository_metrics&#39;</span>][<span style="color:#e6db74">&#39;error_rate&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">%&#34;</span>)
    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Ops/Second: </span><span style="color:#e6db74">{</span>report[<span style="color:#e6db74">&#39;repository_metrics&#39;</span>][<span style="color:#e6db74">&#39;operations_per_second&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
    
    print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">=== GET PRODUCT STATS ===&#34;</span>)
    get_stats <span style="color:#f92672">=</span> report[<span style="color:#e6db74">&#39;operation_details&#39;</span>][<span style="color:#e6db74">&#39;get_product&#39;</span>]
    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;error&#39;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> get_stats:
        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Success Rate: </span><span style="color:#e6db74">{</span>get_stats[<span style="color:#e6db74">&#39;success_rate&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">%&#34;</span>)
        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Avg Latency: </span><span style="color:#e6db74">{</span>get_stats[<span style="color:#e6db74">&#39;avg_duration_ms&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">ms&#34;</span>)
        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;P95 Latency: </span><span style="color:#e6db74">{</span>get_stats[<span style="color:#e6db74">&#39;p95_duration_ms&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">ms&#34;</span>)
    
    print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">=== CREATE PRODUCT STATS ===&#34;</span>)
    create_stats <span style="color:#f92672">=</span> report[<span style="color:#e6db74">&#39;operation_details&#39;</span>][<span style="color:#e6db74">&#39;create_product&#39;</span>]
    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;error&#39;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> create_stats:
        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Success Rate: </span><span style="color:#e6db74">{</span>create_stats[<span style="color:#e6db74">&#39;success_rate&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">%&#34;</span>)
        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Avg Latency: </span><span style="color:#e6db74">{</span>create_stats[<span style="color:#e6db74">&#39;avg_duration_ms&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">ms&#34;</span>)
    
    <span style="color:#66d9ef">return</span> report

<span style="color:#75715e"># Run simulation</span>
performance_report <span style="color:#f92672">=</span> simulate_production_traffic()
</code></pre></div>
<div class="notices info" ><p><strong>Screenshot Location</strong>: Add screenshot showing performance monitoring output with detailed metrics</p>
</div>

<h2 id="production-patterns-best-practices">Production Patterns Best Practices</h2>
<h3 id="architecture-guidelines">Architecture Guidelines</h3>
<p><strong>Enterprise-grade DynamoDB architecture</strong>:</p>
<ul>
<li><strong>Separation of Concerns</strong>: Clear repository/service layers</li>
<li><strong>Error Handling</strong>: Comprehensive error management</li>
<li><strong>Resource Management</strong>: Connection pooling and optimization</li>
<li><strong>Monitoring</strong>: Detailed metrics and observability</li>
<li><strong>Caching</strong>: Intelligent caching strategies</li>
</ul>
<h3 id="performance-optimization">Performance Optimization</h3>
<p><strong>Production performance patterns</strong>:</p>
<ul>
<li><strong>Connection Reuse</strong>: Pool database connections</li>
<li><strong>Batch Operations</strong>: Group related operations</li>
<li><strong>Async Processing</strong>: Non-blocking operation patterns</li>
<li><strong>Circuit Breakers</strong>: Protect against cascade failures</li>
<li><strong>Graceful Degradation</strong>: Fallback strategies</li>
</ul>
<h3 id="operational-excellence">Operational Excellence</h3>
<p><strong>Production readiness checklist</strong>:</p>
<ul>
<li>‚úÖ <strong>Comprehensive logging</strong>: All operations logged</li>
<li>‚úÖ <strong>Metrics collection</strong>: Performance and business metrics</li>
<li>‚úÖ <strong>Error handling</strong>: Graceful failure management</li>
<li>‚úÖ <strong>Resource optimization</strong>: Efficient resource usage</li>
<li>‚úÖ <strong>Monitoring dashboards</strong>: Real-time operational visibility</li>
</ul>

<div class="notices success" ><p><strong>Production Mastery</strong>: You&rsquo;ve mastered enterprise-grade DynamoDB patterns! Your applications are now ready for production with robust error handling, performance optimization, and comprehensive monitoring.</p>
</div>

<h2 id="exercise-summary">Exercise Summary</h2>
<p>You&rsquo;ve implemented production-ready patterns:</p>
<ul>
<li>‚úÖ <strong>Repository pattern</strong> with clean data access abstraction</li>
<li>‚úÖ <strong>Caching strategies</strong> for performance optimization</li>
<li>‚úÖ <strong>Error handling</strong> with retry logic and circuit breakers</li>
<li>‚úÖ <strong>Connection pooling</strong> for resource efficiency</li>
<li>‚úÖ <strong>Comprehensive monitoring</strong> for operational excellence</li>
<li>‚úÖ <strong>Production patterns</strong> used by enterprise applications</li>
</ul>
<h2 id="module-6-complete">Module 6 Complete</h2>
<p>Congratulations! You&rsquo;ve mastered advanced DynamoDB patterns and can now build enterprise-grade applications with:</p>
<p>üöÄ <strong>Batch operations</strong> for maximum efficiency
üõ°Ô∏è <strong>Conditional updates</strong> for data integrity
‚ö° <strong>Query optimization</strong> for performance and cost efficiency
üè¢ <strong>Production patterns</strong> for enterprise reliability</p>
<p>Your DynamoDB expertise now matches that of companies serving millions of users - all while staying within AWS Free Tier limits!</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/6-advanced-patterns/6.3-advanced-query-techniques/" title="6.3 Advanced Query Techniques"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/7-cleanup-resources/" title="7. Cleanup Resources" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/js/clipboard.min.js?1755087796"></script>
    <script src="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/js/perfect-scrollbar.min.js?1755087796"></script>
    <script src="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/js/perfect-scrollbar.jquery.min.js?1755087796"></script>
    <script src="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/js/jquery.sticky.js?1755087796"></script>
    <script src="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/js/featherlight.min.js?1755087796"></script>
    <script src="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/js/highlight.pack.js?1755087796"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/js/modernizr.custom-3.6.0.js?1755087796"></script>
    <script src="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/js/learn.js?1755087796"></script>
    <script src="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/js/hugo-learn.js?1755087796"></script>

    <link href="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/mermaid/mermaid.css?1755087796" rel="stylesheet" />
    <script src="/DynamoDB-Advanced-Patterns-and-Global-Tables-Streams/mermaid/mermaid.js?1755087796"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
